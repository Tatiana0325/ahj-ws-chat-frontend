!function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);new class{constructor(e){this.container=document.getElementById("widget"),this.openUsers=[],this.curentUser=null,this.ws=new WebSocket(e),this.cashMessages=[],this.ws.addEventListener("open",()=>{console.log("connected")}),this.ws.addEventListener("message",e=>{const t=JSON.parse(e.data);"error"===t.type?this.showError(document.querySelector("input"),t.text):"allUsers"===t.type?(this.openUsers=t.data,this.hideForm(),this.showChat()):"disconnect"===t.type||"connect"===t.type?console.log(t.data):"addMessage"===t.type&&(this.cashMessages.push(t.data.data),this.showMessage(t.data.data))}),this.ws.addEventListener("close",e=>{console.log("connection closed",e)}),this.ws.addEventListener("error",()=>{console.log("error")}),window.addEventListener("beforeunload",()=>{this.ws.send(JSON.stringify({type:"deleteUser",user:this.curentUser}))})}createNick(){const e=document.createElement("form");e.classList.add("form");const t=document.createElement("h4");t.classList.add("head");const s=document.createElement("div");s.classList.add("box");const n=document.createElement("input"),r=document.createElement("button");r.classList.add("btn"),t.textContent="Choose nickname",r.textContent="Next",n.name="nick",s.appendChild(n),e.append(t,s,r),this.container.appendChild(e),e.addEventListener("submit",e=>{e.preventDefault();const t=e.target.nick.value.toLowerCase(),s={type:"addUser",user:t};this.curentUser=t,this.ws.send(JSON.stringify(s))}),n.addEventListener("input",()=>{this.deleteError()})}hideForm(){this.container.removeChild(this.container.firstChild)}showChat(){const e=document.createElement("div");e.innerHTML=`\n      <h2 class="welcome">Welcome to the chat</h2>\n      <div class="wrapper">\n        <div class="list-part">\n        </div>\n        <div class="chat">\n            <div class="messages">\n            ${this.showCashMessages().outerHTML}\n            </div>\n            <div class="message-text">\n            <form class="form-message">\n                <input type="text" name="message" id="message" class="input" \n                placeholder="Type your message here">\n            </form>\n            </div>\n        </div>\n      </div>\n    `,this.container.appendChild(e),document.querySelector(".form-message").addEventListener("submit",e=>{e.preventDefault();const t=e.target.message.value.trim(),s=(new Date).toLocaleString();this.ws.send(JSON.stringify({type:"addMessage",data:{user:this.curentUser,message:t,date:s}})),e.target.message.value=""}),this.showPart()}showCashMessages(){const e=document.createElement("div");return this.cashMessages.forEach(t=>{const s=this.creatMessage(t);e.appendChild(s)}),e}showPart(){const e=document.querySelector(".list-part");this.openUsers.forEach(t=>{const s=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");s.classList.add("user"),n.classList.add("avatar"),r.classList.add("name"),r.textContent=t.name,t.name===this.curentUser&&(r.textContent="You",r.classList.add("you-name"),n.classList.add("you-avatar")),s.append(n,r),e.appendChild(s)})}creatMessage(e){const t=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div");return t.classList.add("message"),n.classList.add("date"),r.classList.add("text"),s.classList.add("small-name"),n.textContent=e.date,s.textContent=e.user,r.textContent=e.message,e.user===this.curentUser&&(t.classList.add("you-message"),s.textContent="You"),t.append(s,n,r),t}showMessage(e){const t=document.querySelector(".messages"),s=this.creatMessage(e);t.appendChild(s)}showError(e,t){e.focus();const s=document.createElement("div");s.dataset.id="error",s.className="form-error",s.textContent=""+t,document.body.appendChild(s);const{top:n,left:r}=e.getBoundingClientRect();s.style.top=window.scrollY+n-e.offsetHeight+s.offsetHeight+"px",s.style.left=window.scrollX+r+"px"}deleteError(){document.querySelector(".form-error")&&document.querySelector(".form-error").remove()}}("wss://ahj-ws-chat-backend.herokuapp.com/ws").createNick()}]);